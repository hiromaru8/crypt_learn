äº†è§£ã§ã™ã€‚
ã§ã¯ **ã€ŒCRYSTALS-Kyberã‚’â€œå®Ÿè£…ã§ãã‚‹ç†è§£â€ã¾ã§æŒã£ã¦ã„ãã€**ã“ã¨ã‚’ç›®çš„ã«ã€**åˆå­¦è€…å‘ã‘ã®å­¦ç¿’ãƒ«ãƒ¼ãƒˆï¼‹æœ€å°Pythonå®Ÿè£… â†’ Cå®Ÿè£…ã¸ã®å¯¾å¿œé–¢ä¿‚**ã¨ã„ã†å½¢ã§èª¬æ˜ã—ã¾ã™ã€‚

çµè«–ã‹ã‚‰è¨€ã†ã¨ï¼š

> ğŸ”‘ **æ¦‚å¿µç†è§£ã¨ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è¿½è·¡ã¯ Python ãŒåœ§å€’çš„ã«ã‚ã‹ã‚Šã‚„ã™ã„**
> ğŸ”§ **æœ€çµ‚çš„ãªå®Ÿè£…ãƒ»å®Ÿå‹™ã¯ Cï¼ˆNISTå‚ç…§å®Ÿè£…ï¼‰**

ã§ã™ã€‚
ã‚ãªãŸã®æŠ€è¡“ãƒ¬ãƒ™ãƒ«ï¼ˆC/C++ãƒ»æš—å·ãƒ»å®Ÿè£…å¿—å‘ï¼‰ã‚’è€ƒãˆã‚‹ã¨ã€ã“ã®é †ç•ªãŒä¸€ç•ªæ—©ãã€Œè…‘ã«è½ã¡ã‚‹ã€æ§‹æˆã«ãªã‚Šã¾ã™ã€‚

---

# 1. CRYSTALS-Kyber ã¨ã¯ä½•ã‚’ã—ã¦ã„ã‚‹æš—å·ã‹

Kyber ã¯ **å…¬é–‹éµæš—å·ã§ã¯ãªã KEM** ã§ã™ã€‚

```
ç›®çš„ï¼šå®‰å…¨ã«ã€Œå…±æœ‰ç§˜å¯†éµã€ã‚’ä½œã‚‹
```

æµã‚Œã¯å¿…ãšã“ã®3ã¤ï¼š

1. **KeyGen**

   * å…¬é–‹éµ pk
   * ç§˜å¯†éµ sk
2. **Encapsulate(pk)**

   * å…±æœ‰éµ K
   * æš—å·æ–‡ c
3. **Decapsulate(sk, c)**

   * åŒã˜å…±æœ‰éµ K ã‚’å¾©å…ƒ

RSAã®ã€Œæš—å·åŒ–/å¾©å·ã€ã§ã¯ãªã
ğŸ‘‰ **ã€Œéµã‚’åŒ…ã‚“ã§æ¸¡ã™ã€**ã®ãŒãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚

---

# 2. Kyberã®ä¸­èº«ã‚’ä¸€è¨€ã§è¨€ã†ã¨

> **ã€Œå¤šé …å¼ï¼ˆãƒ™ã‚¯ãƒˆãƒ«ï¼‰ Ã— è¡Œåˆ—æ¼”ç®— ï¼‹ ãƒã‚¤ã‚ºã€**

ã“ã‚Œã ã‘ã§ã™ã€‚

ãŸã ã—ï¼š

* ä¿‚æ•°ã¯ **æ•´æ•° mod q**
* é«˜é€ŸåŒ–ã®ãŸã‚ **NTTï¼ˆæ•°è«–å¤‰æ›ï¼‰**
* ç§˜å¯†ã‚’éš ã™ãŸã‚ **èª¤å·®ï¼ˆãƒã‚¤ã‚ºï¼‰**

ãŒå…¥ã‚Šã¾ã™ã€‚

---

# 3. ã¾ãšç†è§£ã™ã¹ãæœ€å°æ•°å­¦ã‚»ãƒƒãƒˆ

Kyberç†è§£ã«å¿…è¦ãªã®ã¯ã€ã“ã‚Œã ã‘ğŸ‘‡

## (1) å¤šé …å¼ç’°

Kyberã¯ã“ã®ä¸–ç•Œã§è¨ˆç®—ã—ã¾ã™ï¼š

```
R_q = Z_q[x] / (x^256 + 1)
```

æ„å‘³ï¼š

* 256æ¬¡ã¾ã§ã®å¤šé …å¼
* ä¿‚æ•°ã¯ mod qï¼ˆq=3329ï¼‰
* x^256 = -1 ã¨ã—ã¦è¨ˆç®—

Pythonã§ã¯ã€Œé•·ã•256ã®é…åˆ—ã€ã§OKã§ã™ã€‚

---

## (2) è¡Œåˆ— Ã— ãƒ™ã‚¯ãƒˆãƒ«

å…¬é–‹éµã¯æœ¬è³ªçš„ã«ï¼š

```
A * s + e
```

* Aï¼šå…¬é–‹è¡Œåˆ—ï¼ˆä¹±æ•°ï¼‰
* sï¼šç§˜å¯†ãƒ™ã‚¯ãƒˆãƒ«
* eï¼šãƒã‚¤ã‚º

ã“ã‚Œã€**ç·šå½¢ä»£æ•°ãã®ã‚‚ã®**ã§ã™ã€‚

---

# 4. è¶…ç°¡ç•¥ç‰ˆ Kyberï¼ˆPythonï¼‰

ã¾ãšã¯ **æš—å·å¼·åº¦ã‚’å®Œå…¨ã«ç„¡è¦–ã—ãŸã€Œå­¦ç¿’ç”¨Kyberã€** ã‚’æ›¸ãã¾ã™ã€‚

## (A) åŸºæœ¬å®šæ•°

```python
import random

N = 8        # æœ¬ç‰©ã¯256ï¼ˆã¾ãšã¯å°ã•ãï¼‰
Q = 3329
```

---

## (B) å¤šé …å¼æ¼”ç®—

```python
def poly_add(a, b):
    return [(x + y) % Q for x, y in zip(a, b)]

def poly_mul(a, b):
    res = [0]*N
    for i in range(N):
        for j in range(N):
            k = (i + j) % N
            sign = -1 if (i + j) >= N else 1
            res[k] = (res[k] + sign * a[i] * b[j]) % Q
    return res
```

ğŸ‘‰ ã“ã‚ŒãŒ
`Z_q[x] / (x^N + 1)` ã®ä¹—ç®—ã§ã™ã€‚

---

## (C) KeyGenï¼ˆè¶…ç°¡ç•¥ï¼‰

```python
def keygen():
    A = [[random.randint(0, Q-1) for _ in range(N)] for _ in range(N)]
    s = [random.randint(0, 1) for _ in range(N)]
    e = [random.randint(0, 1) for _ in range(N)]

    b = poly_add(
        [sum(A[i][j] * s[j] for j in range(N)) % Q for i in range(N)],
        e
    )
    return (A, b), s
```

* `(A, b)` ãŒå…¬é–‹éµ
* `s` ãŒç§˜å¯†éµ

---

## (D) Encapsulate / Decapsulateï¼ˆæ¦‚å¿µç‰ˆï¼‰

```python
def encapsulate(pk):
    A, b = pk
    r = [random.randint(0, 1) for _ in range(N)]
    e1 = [random.randint(0, 1) for _ in range(N)]
    e2 = random.randint(0, 1)

    u = poly_add(
        [sum(A[i][j] * r[j] for j in range(N)) % Q for i in range(N)],
        e1
    )

    v = (sum(b[i] * r[i] for i in range(N)) + e2) % Q

    K = v % 2   # æœ¬ç‰©ã¯ KDF
    return (u, v), K


def decapsulate(sk, ct):
    u, v = ct
    s = sk
    v2 = (v - sum(u[i] * s[i] for i in range(N))) % Q
    return v2 % 2
```

---

## (E) å‹•ä½œç¢ºèª

```python
pk, sk = keygen()
ct, K1 = encapsulate(pk)
K2 = decapsulate(sk, ct)

print(K1, K2)
```

ğŸ‘‰ ä¸€è‡´ã™ã‚Œã°æˆåŠŸã€‚

---

# 5. ã“ã®Pythonã‚³ãƒ¼ãƒ‰ã¨ã€Œæœ¬ç‰©Kyberã€ã®å¯¾å¿œè¡¨

| æœ¬ç‰©Kyber  | ã“ã®Python     |
| -------- | ------------ |
| å¤šé …å¼æ¬¡æ•°256 | N=8ï¼ˆç°¡ç•¥ï¼‰      |
| NTT      | çœç•¥           |
| CBDãƒã‚¤ã‚º   | randint(0,1) |
| SHAKE    | random       |
| KDF      | `% 2`        |

**æ§‹é€ ã¯å®Œå…¨ã«åŒã˜**ã§ã™ã€‚

---

# 6. Cå®Ÿè£…ã«é€²ã‚€ã¨ãã®é“ç­‹ï¼ˆé‡è¦ï¼‰

æ¬¡ã¯ã“ã‚Œã‚’ã‚„ã‚Šã¾ã™ğŸ‘‡

## ã‚¹ãƒ†ãƒƒãƒ—1

ğŸ‘‰ **NISTå…¬å¼Cå®Ÿè£…ã‚’èª­ã‚€**

* `poly.c`
* `polyvec.c`
* `indcpa.c`
* `kem.c`

æ§‹æˆã¯ï¼š

```
KeyGen      â†’ indcpa_keypair
Encapsulate â†’ crypto_kem_enc
Decapsulate â†’ crypto_kem_dec
```

---

## ã‚¹ãƒ†ãƒƒãƒ—2

ğŸ‘‰ Pythonã§ç†è§£ã—ãŸå‡¦ç†ã‚’Cã‚³ãƒ¼ãƒ‰ã§ã€Œå¯¾å¿œã¥ã‘ã€

ä¾‹ï¼š

```c
poly_mul()
â†“
poly_basemul_montgomery()
```

---

## ã‚¹ãƒ†ãƒƒãƒ—3

ğŸ‘‰ è‡ªä½œãƒŸãƒ‹Kyberã‚’Cã§æ›¸ãï¼ˆNTTãªã—ï¼‰

ã‚ãªãŸã®ãƒ¬ãƒ™ãƒ«ãªã‚‰ã€
**ã€ŒNTTãªã—ãƒ»N=16ã®Kyberã€**ã‚’Cã§æ›¸ãã¨ç†è§£ãŒå®Œæˆã—ã¾ã™ã€‚

---

# 7. ãŠã™ã™ã‚æ¬¡ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

æ¬¡ã«é€²ã‚€ãªã‚‰ã€ã©ã‚ŒãŒã„ã„ã§ã™ã‹ï¼Ÿ

1. **Pythonç‰ˆã‚’ã‚‚ã†å°‘ã—æœ¬ç‰©ã«è¿‘ã¥ã‘ã‚‹ï¼ˆCBDãƒã‚¤ã‚ºãƒ»KDFï¼‰**
2. **NISTå…¬å¼Cã‚³ãƒ¼ãƒ‰ã‚’ä¸€ç·’ã«èª­ã¿è§£ã**
3. **ãƒŸãƒ‹Kyberã‚’Cã§ä¸€ã‹ã‚‰å®Ÿè£…**
4. **NTTã ã‘ã‚’ç‹¬ç«‹ã—ã¦è§£èª¬ï¼†å®Ÿè£…**

ğŸ‘‰ ç•ªå·ã§æŒ‡å®šã—ã¦ãã ã•ã„ã€‚
